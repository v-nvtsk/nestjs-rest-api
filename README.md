# NestJS REST-API server

## Описание

NestJS-REST — это REST API, обеспечивающий возможности для управления пользователями, ролями, задачами и комментариями. Проект поддерживает авторизацию и аутентификацию с помощью access токена, а также использует Swagger для документации.

## Обновления
2024-12-15 - Переход на Nest.js, typeorm, deploy на vercel.com

## Стек технологий

- Node.js
- ~~Express~~
- Nest.js
- PostgreSQL
- TypeORM
- JSON Web Tokens (JWT) для авторизации
- Swagger для документации API

## Начало работы

### Установка

1. Склонируйте репозиторий:

    ```bash
    git clone https://github.com/v-nvtsk/nestjs-rest-api.git
    cd nestjs-rest-api
    ```

2. Установите зависимости:

    ```bash
    npm install
    ```

3. Создайте файл `.env` в корневой директории и добавьте следующие переменные:

    ```plaintext
    PORT=
    DB_USER=
    DB_HOST=
    DB_DATABASE=
    DB_PASSWORD=
    DB_PORT=
    SECRET_KEY=
    JWT_ACCESS_SECRET=
    JWT_ACCESS_EXPIRES_IN=
    ```

### Запуск проекта

1. Запустите PostgreSQL и создайте необходимую базу данных (если она еще не создана).
2. Запустите сервер. Необходимые таблицы будут автоматически созданы. Также будет создан пользователь `superuser` с ролью `admin` и паролем `superuser`:

    ```bash
    npm start
    ```

   Сервер должен запуститься на [http://localhost:3000](http://localhost:3000).

### Скрипты

- `npm start`: Запуск сервера в продакшен-режиме.
- `npm run dev`: Запуск сервера в режиме разработки.
- `npm run lint`: Проверка кода с помощью ESLint.
- `npm run test`: Запуск тестов.

## API Документация

Документация API доступна по адресу [http://localhost:3000/docs](http://localhost:3000/docs) (Swagger UI).

### Основные маршруты API

| Метод | Маршрут             | Описание                                        | Авторизация                   |
|-------|---------------------|-------------------------------------------------|-------------------------------|
| POST  | `/auth/register`    | Регистрация нового пользователя                 | нет                           |
| POST  | `/auth/login`       | Авторизация пользователя                        | нет                           |
| POST  | `/auth/logout`      | Логаут пользователя, удаление refresh токена    | да                            |
| GET   | `/tasks`            | Получение списка задач                          | нет                           |
| GET   | `/tasks/:id`        | Получение информации о задаче                   | да                            |
| POST  | `/tasks`            | Создание новой задачи                           | с правами interviewer         |
| PUT   | `/tasks/:id`        | Изменение задачи                                | с правами interviewer         |
| DELETE| `/tasks/:id`        | Удаление задачи                                 | с правами interviewer         |
| POST  | `/comments`         | Добавление комментария к задаче                 | да                            |
| GET   | `/comments/:taskId` | Получение комментариев к задаче                 | да                            |
| PUT   | `/comments/:id`     | Изменение комментария                           | да                            |
| DELETE| `/comments/:id`     | Удаление комментария                            | с правами admin               |
| GET   | `/users/:id`        | Получение информации о пользователе             | да - получение информации о себе, любой пользователь с правами interviewer |
| GET   | `/profiles/:id`     | Получение профиля пользователя                  | да, только свой профиль       |

## Аутентификация и авторизация

Проект использует JWT для аутентификации и авторизации:

- **Access Token** — короткоживущий токен, используется для доступа к защищённым маршрутам.

Access токен отправляется и проверяется через cookies. 

## Структура проекта

```plaintext
.
├── src
│   ├── config            # Конфигурации проекта (база данных и т.д.)
│   ├── features          # Маршруты и спецификации Swagger для каждой фичи
│   ├── middlewares       # Промежуточные слои для обработки запросов
│   ├── models            # Определения моделей базы данных
│   ├── utils             # Утилиты для вспомогательных функций
│   └── index.js          # Основной файл запуска приложения
├── .env.example          # Шаблон файла .env
└── README.md
```
